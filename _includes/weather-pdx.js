<script>
var d3,data,dataURL="https://cdn.glitch.com/f7852ab1-df81-411f-bcb2-caf33a9f835b%2Fpdx-weather.csv";function rowConvert(t){return{date:new Date(t.date),dayMin:+t.daily_temp_min,dayMax:+t.daily_temp_max,avgMin:+t.avg_temp_min,avgMax:+t.avg_temp_max,recMin:+t.rec_temp_min,recMax:+t.rec_temp_max,recMinYr:+t.rec_temp_min_yr,recMaxYr:+t.rec_temp_max_yr,cRain:t.daily_precip,recRain:+t.daily_precip_record,recRainYr:+t.precip_daily_record_yr}}function drawCharts(){var t=d3.extent(data,function(t){return t.date}),e=t[0].getUTCFullYear(),a=t[1].getUTCFullYear(),c=d3.select("#chart-container").attr("class","year").append("h2").style("margin","auto").style("width","90%").style("text-align","center").text(a),r=(d3.select("#chart-container").append("div").attr("id","slider-div").style("margin","1% auto").style("max-width","1000px").style("width","75%"),d3.select("#slider-div").append("h3").text(e).style("float","left").style("margin","0"),d3.select("#slider-div").append("h3").text(a).style("float","right").style("margin","0"),d3.select("#slider-div").append("div").attr("id","input-div").style("margin","auto").style("width","75%"),d3.select("#input-div").append("input").attr("type","range").attr("id","slider").attr("min",e).attr("max",a).attr("step",1).attr("value",a).style("margin","0").style("width","100%"),.99*parseInt(d3.select("#chart-container").style("width"))),l=(d3.select("#chart-container").style("width",r+"px").style("margin","auto"),1*parseInt(d3.select("#chart-container").style("width")));console.log("w:",l);var s=l/1.75,n=s/29,i=s/12.5,d=l/20,o=l/100,p=d3.select("#chart-container").append("svg").attr("width",l+"px").attr("height",s+"px"),y=(d3.select("#chart-container").append("div").attr("id","button-container").style("margin","0.5% auto").style("width","75%"),data.filter(function(t){return t.date>new Date("2016, 12, 31")&&t.date<new Date("2017, 12, 31")}));console.log("fd:",y);var u=d3.extent(y,function(t){return t.date}),h=d3.scaleTime().domain([u[0],u[1]]).range([0+d,l-o]),x=d3.min(y,function(t){return t.recMin}),f=d3.max(y,function(t){return t.recMax}),g=d3.scaleLinear().domain([-25,115]).range([s-i,0+n]),m=d3.scaleBand().domain(["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"]).range([0+d,l-o]).paddingInner(.05).paddingOuter(.025),v=p.append("g").attr("class","chart-paths"),w=d3.line().defined(function(t){return t.recMax}).curve(d3.curveStep).x(function(t){return h(t.date)}).y(function(t){return g(t.recMax)}),k=(v.append("path").datum(y).attr("class","crimson").attr("d",w).style("fill","none").style("opacity",1).style("stroke","crimson").style("stroke-width",s/280),d3.line().defined(function(t){return t.recMin}).curve(d3.curveStep).x(function(t){return h(t.date)}).y(function(t){return g(t.recMin)})),b=(v.append("path").datum(y).attr("class","dodgerBlue").attr("d",k).style("fill","none").style("opacity",1).style("stroke","dodgerBlue").style("stroke-width",s/280),d3.area().defined(function(t){return t.avgMin&&t.avgMax}).curve(d3.curveStep).x(function(t){return h(t.date)}).y0(function(t){return g(t.avgMin)}).y1(function(t){return g(t.avgMax)})),M=(v.append("path").datum(y).attr("class","gray").attr("d",b).style("fill","lightGray").style("opacity",.75).style("stroke","black").style("stroke-width",s/750),d3.area().defined(function(t){return t.dayMin&&t.dayMax}).curve(d3.curveStep).x(function(t){return h(t.date)}).y0(function(t){return g(t.dayMin)}).y1(function(t){return g(t.dayMax)})),R=(v.append("path").datum(y).attr("class","orange").attr("d",M).style("fill","darkOrange").style("opacity",.66).style("stroke","black").style("stroke-width",s/500),v.append("text").attr("x",h(new Date("2017, 4, 24"))).attr("y",g(102.5)).attr("fill","crimson").attr("font-size",l/50).attr("font-weight","bold").attr("text-anchor","end").text("Record daily high"),v.append("text").attr("x",h(new Date("2017, 4, 24"))).attr("y",g(92.5)).attr("fill","darkOrange").attr("font-size",l/50).attr("font-weight","bold").attr("text-anchor","end").text("Daily high/low"),v.append("text").attr("x",h(new Date("2017, 4, 24"))).attr("y",g(10)).attr("fill","darkGray").attr("font-size",l/50).attr("font-weight","bold").attr("text-anchor","end").text("Avg. daily high/low"),v.append("text").attr("x",h(new Date("2017, 4, 24"))).attr("y",g(0)).attr("fill","dodgerBlue").attr("font-size",l/50).attr("font-weight","bold").attr("text-anchor","end").text("Record low"),v.append("text").attr("x",h(new Date("2017, 6, 30"))).attr("y",g(-14)).attr("fill","teal").attr("font-size",l/50).attr("font-weight","bold").attr("text-anchor","middle").text("Daily precipitation"),p.append("g").attr("class","month-labels")),D=R.selectAll("g").data(d3.range(1,13,1)).enter().append("g");D.append("line").filter(function(t){return 1!==t}).attr("class","vertical").attr("x1",function(t){return h(new Date("2017, "+t+", 1"))}).attr("y1",g.range()[1]).attr("x2",function(t,e){return h(new Date("2017, "+t+", 1"))}).attr("y2",s-i).attr("stroke","dimGray").attr("stroke-dasharray","5,5").style("stroke-width",s/800),D.append("text").attr("class","month").attr("x",function(t){return h(new Date("2017, "+t+", 1"))+m.bandwidth()/2}).attr("y",g.range()[1]+1).attr("font-size",l/55+"px").attr("text-anchor","middle").text(function(t){return new Date("2017, "+t+", 1").toString().split(" ")[1]});for(var _=l/23,C=l/26,A=p.append("g").attr("class","yAxis"),z=(A.append("line").attr("x1",_).attr("y1",g(f)).attr("x2",_).attr("y2",g(x)).attr("stroke","black").attr("stroke-width",s/500),A.append("line").attr("x1",_-l/200).attr("y1",g(f)).attr("x2",_+l/200).attr("y2",g(f)).style("stroke","crimson").attr("stroke-width",s/400),A.append("text").attr("x",C).attr("y",g(f-1.25)).attr("fill","crimson").attr("font-size",s/40).attr("text-anchor","end").text(f+"°F"),A.append("line").attr("x1",_-l/200).attr("y1",g(x)).attr("x2",_+l/200).attr("y2",g(x)).style("stroke","dodgerBlue").attr("stroke-width",s/400),A.append("text").attr("x",C).attr("y",g(x-1.25)).attr("fill","dodgerBlue").attr("font-size",s/40).attr("text-anchor","end").text(x+"°F"),10);z<=100;z+=20)A.append("line").attr("x1",_-l/200).attr("y1",g(z)).attr("x2",_+l/200).attr("y2",g(z)).attr("stroke-width",s/400),A.append("text").attr("x",C).attr("y",g(z)).attr("font-size",s/40).attr("text-anchor","end").text(z+"°F");var T=p.append("g").attr("class","xAxis").attr("transform","translate(0,"+(s-i)+")").style("font-size",l/75+"px").style("text-anchor","middle").call(d3.axisBottom(h).tickFormat(d3.timeFormat("%b-%d")).ticks(10)),B=p.append("g").attr("class","rain-chart"),S=d3.extent(data,function(t){return+t.cRain}),F=d3.scaleLinear().domain([0,S[1]]).range([g(g.domain()[0]),g(x)]);B.selectAll("rect.rain-bars").data(y,function(t){return t.date}).enter().append("rect").attr("class","rain-bars").attr("x",function(t){return h(t.date)}).attr("y",function(t){return"T"===t.cRain?F(0):F(+t.cRain)}).attr("width",l/475).attr("height",function(t){return F.range()[0]-("0"===t.cRain?F(1e-4):"T"===t.cRain?F(.001):F(+t.cRain))}).attr("fill","teal").attr("opacity",1).append("title").text(function(t){return t.date.toUTCString()+": "+t.cRain+'"'});d3.select("#button-container").append("button").attr("id","sort").text("Sort by Inches").classed("button",!0).classed("active",!1).style("color","white").style("font-size","small").style("font-weight","bold").style("padding","0.5%").style("width","50%").style("border","2.5px solid white");d3.select("#sort").on("click",function(){d3.select("#sort").classed("active",!0),d3.select("#sort2").classed("active",!1),U()});var U=function(){var a=d3.scaleBand().domain(d3.range(1,366,1)).range([0+d,l-o]);d3.selectAll("rect.rain-bars").sort(function(t,e){var a="T"===t.cRain?.001:""===t.cRain?0:+t.cRain,r="T"===e.cRain?.001:""===e.cRain?0:+e.cRain;return d3.descending(a,r)}).transition().duration(1e3).attr("x",function(t,e){return a(e+1)})};d3.select("#button-container").append("button").attr("id","sort2").text("Sort by Date").classed("button",!0).classed("active",!0).style("color","white").style("font-size","small").style("font-weight","bold").style("padding","0.5%").style("width","50%").style("border","2.5px solid white");d3.select("#sort2").on("click",function(){T.call(d3.axisBottom(h).tickFormat(d3.timeFormat("%b-%d")).ticks(10)),d3.select("#sort2").classed("active",!0),d3.select("#sort").classed("active",!1),d3.selectAll("rect.rain-bars").transition().duration(1e3).attr("x",function(t){return h(t.date)})});for(var O=p.append("g").attr("class","my-rainAxis-"),W=(O.append("line").attr("x1",_).attr("y1",F(2)).attr("x2",_).attr("y2",F(S[0])).attr("stroke","black").attr("stroke-width",s/500),0);W<=2;W++)O.append("line").attr("x1",_-l/200).attr("y1",F(W)).attr("x2",_+l/200).attr("y2",F(W)).attr("stroke",1===W?"teal":"black").attr("stroke-width",s/400),A.append("text").attr("x",C).attr("y",F(W-.1)).attr("fill","teal").attr("font-size",s/35).attr("text-anchor","end").text(0===W||2===W?"":W+'"');for(var Y=1;Y<=2;Y++)B.append("line").attr("class","rain-gridlines").attr("x1",h(new Date("2016, 12, 31"))).attr("y1",F(Y)).attr("x2",h(new Date("2017, 12, 31"))).attr("y2",F(Y)).style("stroke-width",s/250).attr("opacity",1).attr("pointer-events","none");var G=p.append("g").attr("class","hover"),I=G.selectAll("rect.hover").data(y).enter().append("rect").attr("class","hover").attr("x",function(t){return h(t.date)}).attr("y",function(t){return g(f)}).attr("width",l/475).attr("height",g(g.domain()[0])-g(f)).attr("fill","black").attr("cursor","crosshair").attr("opacity",0);function L(t){var e=t.date.toUTCString().split(",")[1],a=(G.append("text").attr("class","hoverCirc").attr("x",h(t.date)).attr("y",g(g.domain()[1]-5)).attr("text-anchor","middle").attr("font-size",l/75).attr("font-weight","bold").text(e.slice(0,3)),G.append("circle").attr("class","hoverCirc").attr("cx",h(t.date)).attr("cy",g(t.recMax)).attr("r",l/105).attr("fill","crimson").attr("stroke","black").attr("stroke-width",l/1500).attr("opacity",.75).attr("pointer-events","none"),G.append("circle").attr("class","hoverCirc").attr("cx",h(t.date)).attr("cy",g(t.recMin)).attr("r",l/105).attr("fill","dodgerBlue").attr("stroke","black").attr("stroke-width",l/1500).attr("opacity",.75).attr("pointer-events","none"),G.append("circle").attr("class","hoverCirc").attr("cx",h(t.date)).attr("cy",g(t.dayMax)).attr("r",l/105).attr("fill","darkOrange").attr("stroke","black").attr("stroke-width",l/1500).attr("opacity",0===t.dayMax?0:.75).attr("pointer-events","none"),G.append("circle").attr("class","hoverCirc").attr("cx",h(t.date)).attr("cy",g(t.dayMin)).attr("r",l/105).attr("fill","darkOrange").attr("stroke","black").attr("stroke-width",l/1500).attr("opacity",0===t.dayMax?0:.75).attr("pointer-events","none"),G.append("text").attr("class","hoverCirc").attr("x",h(t.date)).attr("y",g(t.recMax-1.5)).attr("fill","black").attr("font-size",l/75).attr("font-weight","bold").attr("text-anchor","middle").attr("pointer-events","none").text(t.recMax),G.append("text").attr("class","hoverCirc").attr("x",h(t.date)).attr("y",g(t.recMin-1.5)).attr("fill","black").attr("font-size",l/75).attr("font-weight","bold").attr("text-anchor","middle").attr("pointer-events","none").text(t.recMin),G.append("text").attr("class","hoverCirc").attr("x",h(t.date)).attr("y",g(t.dayMax-1.5)).attr("fill","black").attr("font-size",l/75).attr("font-weight","bold").attr("text-anchor","middle").attr("opacity",0===t.dayMax?0:.75).attr("pointer-events","none").text(t.dayMax),G.append("text").attr("class","hoverCirc").attr("x",h(t.date)).attr("y",g(t.dayMin-1.5)).attr("fill","black").attr("font-size",l/75).attr("font-weight","bold").attr("text-anchor","middle").attr("opacity",0===t.dayMax?0:.75).attr("pointer-events","none").text(t.dayMin),+t.cRain);G.append("text").attr("class","hoverCirc").attr("x",h(t.date)-l/110).attr("y","T"===t.cRain?F(.1):F(+t.cRain+.05)).attr("fill","teal").attr("font-size",l/70).attr("font-weight","bolder").attr("stroke","white").attr("stroke-width",l/1750).attr("text-anchor","start").attr("text-anchor",(t.cRain,"start")).attr("pointer-events","none").text("T"===t.cRain?"Trace":""===t.cRain?"":"0"===t.cRain?a.toFixed(1)+'"':a+'"')}I.append("title").text(function(t){return t.date.toUTCString()}),I.on("mouseover",function(t){L(t)}).on("mouseout",function(t){d3.selectAll(".hoverCirc").remove()}),d3.select("#slider").on("change",function(){var a=+d3.select(this).node().value;c.text(a);var t=data.filter(function(t){return t.date>new Date(a-1+", 12, 31")&&t.date<new Date(a+", 12, 31")}),e=d3.extent(t,function(t){return t.date});h.domain([e[0],e[1]]),T.call(d3.axisBottom(h).tickFormat(d3.timeFormat("%b-%d")).ticks(10)),d3.selectAll("path.dodgerBlue").datum(t).transition().duration(1e3).attr("class","dodgerBlue").attr("d",k).style("fill","none").style("opacity",1).style("stroke","dodgerBlue").style("stroke-width",s/280),d3.selectAll("path.crimson").datum(t).transition().duration(1e3).attr("class","crimson").attr("d",w).style("fill","none").style("opacity",1).style("stroke","crimson").style("stroke-width",s/280),d3.selectAll("path.gray").datum(t).transition().duration(1e3).attr("class","gray").attr("d",b).style("fill","lightGray").style("opacity",.75).style("stroke","black").style("stroke-width",s/750),d3.selectAll("path.orange").datum(t).transition().duration(1e3).attr("class","orange").attr("d",M).style("fill","darkOrange").style("opacity",.66).style("stroke","black").style("stroke-width",s/500);var r=B.selectAll("rect").data(t,function(t){return t.date});r.exit().remove();var n=r.enter().append("rect").attr("class","rain-bars").attr("x",function(t){return h(t.date)}).attr("y",function(t){return"T"===t.cRain?F(0):F(+t.cRain)}).attr("width",l/475).attr("height",function(t){return F.range()[0]-("0"===t.cRain?F(1e-4):"T"===t.cRain?F(.001):F(+t.cRain))}).attr("fill","teal").attr("opacity",1);n.append("title").text(function(t){return t.date.toUTCString()+": "+t.cRain+'"'});n.merge(r).transition().duration(750).on("start",function(){d3.select(this).attr("y",function(t){return F(0)}).attr("height",0)}).transition().duration(500).ease(d3.easeBackOut).attr("y",function(t){return"T"===t.cRain?F(0):F(+t.cRain)}).attr("height",function(t){return F.range()[0]-("0"===t.cRain?F(1e-4):"T"===t.cRain?F(.001):F(+t.cRain))});for(var i=1;i<=2;i++)B.append("line").attr("class","rain-gridlines").attr("x1",h(new Date(a-1+", 12, 31"))).attr("y1",F(i)).attr("x2",h(new Date(a+", 12, 31"))).attr("y2",F(i)).style("stroke-width",s/250).attr("opacity",1).attr("pointer-events","none");var d=G.selectAll("rect").data(t,function(t){return t.date});d.exit().remove();var o=d.enter().append("rect").attr("class","hover").attr("x",function(t){return h(t.date)}).attr("y",function(t){return g(f)}).attr("width",l/475).attr("height",g(g.domain()[0])-g(f)).attr("fill","black").attr("cursor","crosshair").attr("opacity",0);o.append("title").text(function(t){return t.date.toUTCString()}),o.on("mouseover",function(t){L(t)}).on("mouseout",function(t){d3.selectAll(".hoverCirc").remove()}),R.selectAll("line").data(d3.range(1,13,1)).filter(function(t){return 1!==t}).attr("x1",function(t){return h(new Date(a+", "+t+", 1"))}).attr("x2",function(t,e){return h(new Date(a+", "+t+", 1"))}),R.selectAll("text").data(d3.range(1,13,1)).attr("x",function(t){return h(new Date(a+", "+t+", 1"))+m.bandwidth()/2})});d3.select("#chart-container").append("h4").style("margin","1% auto").style("max-width","1000px").style("width","90%").style("text-align","center").html('Source: <a href="http://w2.weather.gov/climate/index.php" target="_blank">National Weather Service</a>')}d3.csv(dataURL,rowConvert,function(t){data=t,drawCharts()});
</script>